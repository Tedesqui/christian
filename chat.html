<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title data-key="title">IA Crist√£ - Um Di√°logo de F√©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />

    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        #chat-window {
            background-image: linear-gradient(rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05)), url('images/heaven.jpeg');
            background-size: cover; background-position: center; position: relative; z-index: 40;
        }
        #user-input { caret-color: #2563eb; }
        .hidden { display: none; }
        .mic-wrapper { position: relative; display: inline-flex; align-items: center; justify-content: center; z-index: 50; }
        .recording button { transform: scale(1.5); background-color: #22c55e !important; transition: transform 0.2s ease, background-color 0.2s ease; }
    </style>
</head>

<body class="bg-slate-100 flex items-center justify-center min-h-screen">
    
    <script>
        (() => {
            const token = localStorage.getItem('iaCristaAccessToken');
            if (!token) {
                window.location.href = '/index.html';
                return;
            }
            try {
                const { expiry } = JSON.parse(token);
                if (Date.now() >= expiry) {
                    localStorage.removeItem('iaCristaAccessToken');
                    window.location.href = '/index.html';
                }
            } catch (e) {
                localStorage.removeItem('iaCristaAccessToken');
                window.location.href = '/index.html';
            }
        })();
    </script>

    <div class="flex flex-col w-full max-w-3xl h-[85vh] bg-white rounded-2xl shadow-2xl m-4" style="transform: translateY(-10%)">
        <header class="bg-blue-600 text-white p-6 rounded-t-2xl shadow-md flex items-center space-x-4">
            <img src="images/jesus.jpg" alt="Imagem de Jesus Cristo" data-key="header_alt" class="h-20 w-20 rounded-full object-cover border-2 border-white" />
            <div>
                <h1 class="text-2xl font-bold" data-key="header_title">IA Crist√£</h1>
                <p class="text-sm text-white" data-key="header_subtitle">O seu companheiro para reflex√£o e estudo da Palavra.</p>
            </div>
        </header>

        <main id="chat-window" class="flex-1 p-6 overflow-y-auto">
            <div class="message-ai mb-4 flex">
                <div class="bg-slate-200 text-slate-800 rounded-lg rounded-bl-none p-3 max-w-lg">
                    <p class="text-sm" data-key="welcome_message">Paz do Senhor! Eu sou o seu assistente virtual crist√£o. Estou aqui para te ajudar a aprofundar-se na Palavra de Deus. Sinta-se √† vontade para perguntar sobre vers√≠culos, personagens b√≠blicos, ou para conversarmos sobre os desafios da vida sob a √≥tica crist√£.</p>
                </div>
            </div>
        </main>

        <footer class="p-2 bg-white rounded-b-2xl">
            <div class="w-full">
                <div class="flex items-center bg-slate-100 rounded-full p-1.5">
                    <input type="text" id="user-input" placeholder="Fale ou escreva..." data-key="input_placeholder" class="flex-1 bg-transparent border-none focus:ring-0 text-slate-800 placeholder-slate-400 px-4" />
                    <button id="send-button" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full p-2.5 transition-colors duration-300 ml-2.5 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>
                    </button>
                    <div class="mic-wrapper">
                        <button id="mic-button" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full p-2.5 transition-colors duration-300 ml-2.5">
                            <svg xmlns="http://www.w3.org/2000/svg" id="mic-icon" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const micButton = document.getElementById('mic-button');
        const micWrapper = micButton.parentElement;

        const translations = {
            "pt": { "title": "IA Crist√£ - Um Di√°logo de F√©", "header_alt": "Imagem de Jesus Cristo", "header_title": "IA Crist√£", "header_subtitle": "O seu companheiro para reflex√£o e estudo da Palavra.", "welcome_message": "Paz do Senhor! Eu sou o seu assistente virtual crist√£o. Estou aqui para te ajudar a aprofundar-se na Palavra de Deus. Sinta-se √† vontade para perguntar sobre vers√≠culos, personagens b√≠blicos, ou para conversarmos sobre os desafios da vida sob a √≥tica crist√£.", "input_placeholder": "Fale ou escreva...", "input_placeholder_no_mic": "Escreva...", "listening": "üéôÔ∏è Ouvindo...", "typing_indicator": "A meditar na Palavra", "error_message": "Perd√£o, minha ovelha, ocorreu um erro. Por favor, tente novamente.", "mic_denied": "Permiss√£o para o microfone negada. Ative nas defini√ß√µes do seu navegador.", "mic_error": "Ocorreu um erro no reconhecimento de voz." },
            "en": { "title": "Christian AI - A Dialogue of Faith", "header_alt": "Image of Jesus Christ", "header_title": "Christian AI", "header_subtitle": "Your companion for reflection and study of the Word.", "welcome_message": "Peace of the Lord! I am your Christian virtual assistant. I am here to help you delve deeper into the Word of God. Feel free to ask about verses, biblical characters, or to talk about life's challenges from a Christian perspective.", "input_placeholder": "Speak or write...", "input_placeholder_no_mic": "Write...", "listening": "üéôÔ∏è Listening...", "typing_indicator": "Meditating on the Word", "error_message": "Pardon me, my sheep, an error occurred. Please try again.", "mic_denied": "Microphone permission denied. Please enable it in your browser settings.", "mic_error": "An error occurred with voice recognition." },
            "es": { "title": "IA Cristiana - Un Di√°logo de Fe", "header_alt": "Imagen de Jesucristo", "header_title": "IA Cristiana", "header_subtitle": "Tu compa√±ero para la reflexi√≥n y el estudio de la Palabra.", "welcome_message": "¬°Paz del Se√±or! Soy tu asistente virtual cristiano. Estoy aqu√≠ para ayudarte a profundizar en la Palabra de Dios. No dudes en preguntar sobre vers√≠culos, personajes b√≠blicos, o para conversar sobre los desaf√≠os de la vida desde la √≥ptica cristiana.", "input_placeholder": "Habla o escribe...", "input_placeholder_no_mic": "Escribe...", "listening": "üéôÔ∏è Escuchando...", "typing_indicator": "Meditando en la Palabra", "error_message": "Perd√≥n, mi oveja, ocurri√≥ un error. Por favor, int√©ntalo de nuevo.", "mic_denied": "Se deneg√≥ el permiso para el micr√≥fono. Por favor, act√≠valo en la configuraci√≥n de tu navegador.", "mic_error": "Ocurri√≥ un error con el reconocimiento de voz." },
            "it": { "title": "IA Cristiana - Un Dialogo di Fede", "header_alt": "Immagine di Ges√π Cristo", "header_title": "IA Cristiana", "header_subtitle": "Il tuo compagno per la riflessione e lo studio della Parola.", "welcome_message": "Pace del Signore! Sono il tuo assistente virtuale cristiano. Sono qui per aiutarti ad approfondire la Parola di Dio. Sentiti libero di chiedere versetti, personaggi biblici o di parlare delle sfide della vita da una prospettiva cristiana.", "input_placeholder": "Parla o scrivi...", "input_placeholder_no_mic": "Scrivi...", "listening": "üéôÔ∏è In ascolto...", "typing_indicator": "Meditando sulla Parola", "error_message": "Perdona, mia pecora, si √® verificato un errore. Per favore, riprova.", "mic_denied": "Permesso per il microfono negato. Abilitalo nelle impostazioni del browser.", "mic_error": "Si √® verificato un errore con il riconoscimento vocale." },
            "fr": { "title": "IA Chr√©tienne - Un Dialogue de Foi", "header_alt": "Image de J√©sus-Christ", "header_title": "IA Chr√©tienne", "header_subtitle": "Votre compagnon pour la r√©flexion et l'√©tude de la Parole.", "welcome_message": "Paix du Seigneur ! Je suis votre assistant virtuel chr√©tien. Je suis ici pour vous aider √† approfondir la Parole de Dieu. N'h√©sitez pas √† poser des questions sur des versets, des personnages bibliques, ou √† parler des d√©fis de la vie d'un point de vue chr√©tien.", "input_placeholder": "Parlez ou √©crivez...", "input_placeholder_no_mic": "√âcrivez...", "listening": "üéôÔ∏è √âcoute...", "typing_indicator": "M√©ditation sur la Parole", "error_message": "Pardon, mon mouton, une erreur est survenue. Veuillez r√©essayer.", "mic_denied": "Permission du microphone refus√©e. Veuillez l'activer dans les param√®tres de votre navigateur.", "mic_error": "Une erreur est survenue avec la reconnaissance vocale." },
            "de": { "title": "Christliche KI - Ein Dialog des Glaubens", "header_alt": "Bild von Jesus Christus", "header_title": "Christliche KI", "header_subtitle": "Ihr Begleiter zur Besinnung und zum Studium des Wortes.", "welcome_message": "Friede des Herrn! Ich bin Ihr christlicher virtueller Assistent. Ich bin hier, um Ihnen zu helfen, tiefer in das Wort Gottes einzutauchen. Fragen Sie gerne nach Versen, biblischen Charakteren oder sprechen Sie √ºber die Herausforderungen des Lebens aus christlicher Sicht.", "input_placeholder": "Sprechen oder schreiben Sie...", "input_placeholder_no_mic": "Schreiben Sie...", "listening": "üéôÔ∏è H√∂re zu...", "typing_indicator": "Meditiere √ºber das Wort", "error_message": "Verzeihung, mein Schaf, ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.", "mic_denied": "Mikrofonberechtigung verweigert. Bitte aktivieren Sie sie in Ihren Browsereinstellungen.", "mic_error": "Ein Fehler bei der Spracherkennung ist aufgetreten." },
            "ru": { "title": "–•—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∏–π –ò–ò - –î–∏–∞–ª–æ–≥ –≤–µ—Ä—ã", "header_alt": "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ò–∏—Å—É—Å–∞ –•—Ä–∏—Å—Ç–∞", "header_title": "–•—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∏–π –ò–ò", "header_subtitle": "–í–∞—à —Å–ø—É—Ç–Ω–∏–∫ –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π –∏ –∏–∑—É—á–µ–Ω–∏—è –°–ª–æ–≤–∞.", "welcome_message": "–ú–∏—Ä –ì–æ—Å–ø–æ–¥–µ–Ω—å! –Ø –≤–∞—à —Ö—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∏–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –≤–∞–º –≥–ª—É–±–∂–µ –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –°–ª–æ–≤–æ –ë–æ–∂—å–µ. –ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –æ —Å—Ç–∏—Ö–∞—Ö, –±–∏–±–ª–µ–π—Å–∫–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–∞—Ö –∏–ª–∏ –≥–æ–≤–æ—Ä–∏—Ç—å –æ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä—É–¥–Ω–æ—Å—Ç—è—Ö —Å —Ö—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è.", "input_placeholder": "–ì–æ–≤–æ—Ä–∏—Ç–µ –∏–ª–∏ –ø–∏—à–∏—Ç–µ...", "input_placeholder_no_mic": "–ü–∏—à–∏—Ç–µ...", "listening": "üéôÔ∏è –°–ª—É—à–∞—é...", "typing_indicator": "–†–∞–∑–º—ã—à–ª—è—è –Ω–∞–¥ –°–ª–æ–≤–æ–º", "error_message": "–ü—Ä–æ—Å—Ç–∏, –æ–≤—Ü–∞ –º–æ—è, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.", "mic_denied": "–î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∑–∞–ø—Ä–µ—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–∫–ª—é—á–∏—Ç–µ –µ–≥–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∞—à–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞.", "mic_error": "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º –≥–æ–ª–æ—Å–∞." },
            "ja": { "title": "„Ç≠„É™„Çπ„ÉàÊïôAI - ‰ø°‰ª∞„ÅÆÂØæË©±", "header_alt": "„Ç§„Ç®„Çπ„Éª„Ç≠„É™„Çπ„Éà„ÅÆÁîªÂÉè", "header_title": "„Ç≠„É™„Çπ„ÉàÊïôAI", "header_subtitle": "„Åø„Åì„Å®„Å∞„ÅÆÈªôÊÉ≥„Å®Á†îÁ©∂„ÅÆ„Åü„ÇÅ„ÅÆ„ÅÇ„Å™„Åü„ÅÆ‰º¥‰æ∂„ÄÇ", "welcome_message": "‰∏ª„ÅÆÂπ≥ÂíåÔºÅÁßÅ„ÅØ„ÅÇ„Å™„Åü„ÅÆ„Ç≠„É™„Çπ„ÉàÊïô„Éê„Éº„ÉÅ„É£„É´„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Åß„Åô„ÄÇÁ•û„ÅÆË®ÄËëâ„Çí„Çà„ÇäÊ∑±„ÅèÊé¢Ê±Ç„Åô„Çã„ÅäÊâã‰ºù„ÅÑ„Çí„Åó„Åæ„Åô„ÄÇËÅñÂè•„ÇÑËÅñÊõ∏„ÅÆÁôªÂ†¥‰∫∫Áâ©„Å´„Å§„ÅÑ„Å¶„ÄÅ„Åæ„Åü„Ç≠„É™„Çπ„ÉàÊïô„ÅÆË¶≥ÁÇπ„Åã„Çâ‰∫∫Áîü„ÅÆË™≤È°å„Å´„Å§„ÅÑ„Å¶„ÅäÊ∞óËªΩ„Å´„ÅäÂ∞ã„Å≠„Åè„Å†„Åï„ÅÑ„ÄÇ", "input_placeholder": "Ë©±„Åô„ÅãÊõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ...", "input_placeholder_no_mic": "Êõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ...", "listening": "üéôÔ∏è ËÅû„ÅÑ„Å¶„ÅÑ„Åæ„Åô...", "typing_indicator": "„Åø„Åì„Å®„Å∞„ÇíÈªôÊÉ≥‰∏≠", "error_message": "Áî≥„ÅóË®≥„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÅÊàë„ÅåÁæä„Çà„ÄÅ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ", "mic_denied": "„Éû„Ç§„ÇØ„ÅÆË®±ÂèØ„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„ÅßÊúâÂäπ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", "mic_error": "Èü≥Â£∞Ë™çË≠ò„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ" },
            "ko": { "title": "Í∏∞ÎèÖÍµê AI - Ïã†ÏïôÏùò ÎåÄÌôî", "header_alt": "ÏòàÏàò Í∑∏Î¶¨Ïä§ÎèÑ Ïù¥ÎØ∏ÏßÄ", "header_title": "Í∏∞ÎèÖÍµê AI", "header_subtitle": "ÎßêÏîÄ Î¨µÏÉÅÍ≥º Ïó∞Íµ¨Î•º ÏúÑÌïú ÎãπÏã†Ïùò ÎèôÎ∞òÏûê.", "welcome_message": "Ï£ºÎãòÏùò ÌèâÌôî! Ï†ÄÎäî ÎãπÏã†Ïùò Í∏∞ÎèÖÍµê Í∞ÄÏÉÅ ÎπÑÏÑúÏûÖÎãàÎã§. ÌïòÎÇòÎãòÏùò ÎßêÏîÄÏùÑ Îçî ÍπäÏù¥ ÌååÍ≥†ÎìúÎäî Îç∞ ÎèÑÏõÄÏùÑ ÎìúÎ¶¨Í∏∞ ÏúÑÌï¥ Ïó¨Í∏∞ ÏûàÏäµÎãàÎã§. Íµ¨Ï†à, ÏÑ±Í≤Ω Ïù∏Î¨ºÏóê ÎåÄÌï¥ ÏûêÏú†Î°≠Í≤å ÏßàÎ¨∏ÌïòÍ±∞ÎÇò Í∏∞ÎèÖÍµêÏ†Å Í¥ÄÏ†êÏóêÏÑú ÏÇ∂Ïùò ÎèÑÏ†ÑÏóê ÎåÄÌï¥ Ïù¥ÏïºÍ∏∞ÌïòÏã≠ÏãúÏò§.", "input_placeholder": "ÎßêÌïòÍ±∞ÎÇò Ïì∞ÏÑ∏Ïöî...", "input_placeholder_no_mic": "Ïì∞ÏÑ∏Ïöî...", "listening": "üéôÔ∏è Îì£Í≥† ÏûàÏäµÎãàÎã§...", "typing_indicator": "ÎßêÏîÄÏùÑ Î¨µÏÉÅ Ï§ë", "error_message": "Ï£ÑÏÜ°Ìï©ÎãàÎã§, ÎÇ¥ ÏñëÏù¥Ïó¨, Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî.", "mic_denied": "ÎßàÏù¥ÌÅ¨ Í∂åÌïúÏù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§. Î∏åÎùºÏö∞Ï†Ä ÏÑ§Ï†ïÏóêÏÑú ÌôúÏÑ±ÌôîÌï¥ Ï£ºÏÑ∏Ïöî„ÄÇ", "mic_error": "ÏùåÏÑ± Ïù∏ÏãùÏóê Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§„ÄÇ" },
            "zh": { "title": "Âü∫Áù£ÊïôAI - ‰ø°‰ª∞ÁöÑÂØπËØù", "header_alt": "ËÄ∂Á®£Âü∫Áù£ÁöÑÂΩ¢Ë±°", "header_title": "Âü∫Áù£ÊïôAI", "header_subtitle": "ÊÇ®ÂèçÊÄùÂíåÂ≠¶‰π†Âú£Ë®ÄÁöÑ‰º¥‰æ£„ÄÇ", "welcome_message": "‰∏ªÁöÑÂπ≥ÂÆâÔºÅÊàëÊòØÊÇ®ÁöÑÂü∫Áù£ÊïôËôöÊãüÂä©Êâã„ÄÇÊàëÂú®ËøôÈáåÂ∏ÆÂä©ÊÇ®Êõ¥Ê∑±ÂÖ•Âú∞Êé¢Á©∂Á•ûÁöÑËØùËØ≠„ÄÇÊ¨¢ËøéÈöèÊó∂ËØ¢ÈóÆÁªèÊñá„ÄÅÂú£Áªè‰∫∫Áâ©ÔºåÊàñ‰ªéÂü∫Áù£ÊïôÁöÑËßíÂ∫¶Ë∞àËÆ∫ÁîüÊ¥ª‰∏≠ÁöÑÊåëÊàò„ÄÇ", "input_placeholder": "ËØ¥ËØùÊàñ‰π¶ÂÜô...", "input_placeholder_no_mic": "‰π¶ÂÜô...", "listening": "üéôÔ∏è Ê≠£Âú®ËÅÜÂê¨...", "typing_indicator": "ÈªòÊÉ≥Âú£Ë®Ä", "error_message": "ÂØπ‰∏çËµ∑ÔºåÊàëÁöÑÁæäÔºåÂèëÁîü‰∫ÜÈîôËØØ„ÄÇËØ∑ÂÜçËØï‰∏ÄÊ¨°„ÄÇ", "mic_denied": "È∫¶ÂÖãÈ£éÊùÉÈôêË¢´ÊãíÁªù„ÄÇËØ∑Âú®ÊÇ®ÁöÑÊµèËßàÂô®ËÆæÁΩÆ‰∏≠ÂêØÁî®ÂÆÉ„ÄÇ", "mic_error": "ËØ≠Èü≥ËØÜÂà´ÂèëÁîüÈîôËØØ„ÄÇ" },
            "hi": { "title": "‡§à‡§∏‡§æ‡§à ‡§è‡§Ü‡§à - ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡§æ ‡§è‡§ï ‡§∏‡§Ç‡§µ‡§æ‡§¶", "header_alt": "‡§à‡§∏‡§æ ‡§Æ‡§∏‡•Ä‡§π ‡§ï‡•Ä ‡§õ‡§µ‡§ø", "header_title": "‡§à‡§∏‡§æ‡§à ‡§è‡§Ü‡§à", "header_subtitle": "‡§µ‡§ö‡§® ‡§ï‡•á ‡§ö‡§ø‡§Ç‡§§‡§® ‡§î‡§∞ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§æ‡§•‡•Ä‡•§", "welcome_message": "‡§™‡•ç‡§∞‡§≠‡•Å ‡§ï‡•Ä ‡§∂‡§æ‡§Ç‡§§‡§ø! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§à‡§∏‡§æ‡§à ‡§Ü‡§≠‡§æ‡§∏‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•Ç‡§Å‡•§ ‡§Æ‡•à‡§Ç ‡§Ø‡§π‡§æ‡§Å ‡§™‡§∞‡§Æ‡•á‡§∂‡•ç‡§µ‡§∞ ‡§ï‡•á ‡§µ‡§ö‡§® ‡§Æ‡•á‡§Ç ‡§ó‡§π‡§∞‡§æ‡§à ‡§∏‡•á ‡§â‡§§‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•Ç‡§Å‡•§ ‡§õ‡§Ç‡§¶‡•ã‡§Ç, ‡§¨‡§æ‡§á‡§¨‡§ø‡§≤ ‡§ï‡•á ‡§™‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡•á‡§Ç, ‡§Ø‡§æ ‡§à‡§∏‡§æ‡§à ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø‡§ï‡•ã‡§£ ‡§∏‡•á ‡§ú‡•Ä‡§µ‡§® ‡§ï‡•Ä ‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§", "input_placeholder": "‡§¨‡•ã‡§≤‡•á‡§Ç ‡§Ø‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç...", "input_placeholder_no_mic": "‡§≤‡§ø‡§ñ‡•á‡§Ç...", "listening": "üéôÔ∏è ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å...", "typing_indicator": "‡§µ‡§ö‡§® ‡§™‡§∞ ‡§Æ‡§®‡§® ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à", "error_message": "‡§Æ‡•Å‡§ù‡•á ‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§Æ‡•á‡§∞‡•Ä ‡§≠‡•á‡§°‡§º, ‡§è‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®: ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§", "mic_denied": "‡§Æ‡§æ‡§á‡§ï‡•ç‡§∞‡•ã‡§´‡•ã‡§® ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§∏‡•á ‡§Ö‡§™‡§®‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡•á‡§Ç‡•§", "mic_error": "‡§Ü‡§µ‡§æ‡§ú ‡§™‡§π‡§ö‡§æ‡§® ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§" },
            "fil": { "title": "Christian AI - Isang Diyalogo ng Pananampalataya", "header_alt": "Imahe ni Hesukristo", "header_title": "Christian AI", "header_subtitle": "Ang iyong kasama para sa pagninilay at pag-aaral ng Salita.", "welcome_message": "Kapayapaan ng Panginoon! Ako ang iyong Christian virtual assistant. Narito ako upang tulungan kang mas malalim na pag-aralan ang Salita ng Diyos. Huwag mag-atubiling magtanong tungkol sa mga talata, mga tauhan sa bibliya, o pag-usapan ang mga hamon sa buhay mula sa isang Kristiyanong pananaw.", "input_placeholder": "Magsalita o magsulat...", "input_placeholder_no_mic": "Magsulat...", "listening": "üéôÔ∏è Nakikinig...", "typing_indicator": "Nagninilay sa Salita", "error_message": "Patawarin mo ako, aking tupa, nagkaroon ng error. Pakisubukang muli.", "mic_denied": "Tinanggihan ang pahintulot sa mikropono. Paki-enable ito sa mga setting ng iyong browser.", "mic_error": "Nagkaroon ng error sa voice recognition." },
            "sv": { "title": "Kristen AI - En dialog om tro", "header_alt": "Bild av Jesus Kristus", "header_title": "Kristen AI", "header_subtitle": "Din f√∂ljeslagare f√∂r reflektion och studier av Ordet.", "welcome_message": "Herrens frid! Jag √§r din kristna virtuella assistent. Jag √§r h√§r f√∂r att hj√§lpa dig att f√∂rdjupa dig i Guds Ord. Fr√•ga g√§rna om verser, bibliska karakt√§rer eller prata om livets utmaningar ur ett kristet perspektiv.", "input_placeholder": "Tala eller skriv...", "input_placeholder_no_mic": "Skriv...", "listening": "üéôÔ∏è Lyssnar...", "typing_indicator": "Mediterar √∂ver Ordet", "error_message": "F√∂rl√•t mig, mitt f√•r, ett fel intr√§ffade. F√∂rs√∂k igen.", "mic_denied": "Mikrofontillst√•nd nekat. Aktivera det i din webbl√§sares inst√§llningar.", "mic_error": "Ett fel intr√§ffade med r√∂stigenk√§nning." },
            "pl": { "title": "Chrze≈õcija≈Ñska SI - Dialog wiary", "header_alt": "Obraz Jezusa Chrystusa", "header_title": "Chrze≈õcija≈Ñska SI", "header_subtitle": "Tw√≥j towarzysz do refleksji i studiowania S≈Çowa.", "welcome_message": "Pok√≥j Pa≈Ñski! Jestem twoim chrze≈õcija≈Ñskim wirtualnym asystentem. Jestem tutaj, aby pom√≥c ci zag≈Çƒôbiƒá siƒô w S≈Çowo Bo≈ºe. Zapraszam do zadawania pyta≈Ñ o wersety, postacie biblijne lub do rozmowy o wyzwaniach ≈ºyciowych z chrze≈õcija≈Ñskiej perspektywy.", "input_placeholder": "M√≥w lub pisz...", "input_placeholder_no_mic": "Pisz...", "listening": "üéôÔ∏è S≈Çucham...", "typing_indicator": "Rozmy≈õlanie nad S≈Çowem", "error_message": "Wybacz mi, moja owco, wystƒÖpi≈Ç b≈ÇƒÖd. Spr√≥buj ponownie.", "mic_denied": "Odmowa dostƒôpu do mikrofonu. W≈ÇƒÖcz go w ustawieniach przeglƒÖdarki.", "mic_error": "WystƒÖpi≈Ç b≈ÇƒÖd rozpoznawania mowy." },
            "bn": { "title": "‡¶ñ‡ßç‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶® ‡¶è‡¶Ü‡¶á - ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡ßá‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶≤‡¶æ‡¶™", "header_alt": "‡¶Ø‡ßÄ‡¶∂‡ßÅ ‡¶ñ‡ßç‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø", "header_title": "‡¶ñ‡ßç‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶® ‡¶è‡¶Ü‡¶á", "header_subtitle": "‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶´‡¶≤‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶Ø‡¶º‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ô‡ßç‡¶ó‡ßÄ‡•§", "welcome_message": "‡¶™‡ßç‡¶∞‡¶≠‡ßÅ‡¶∞ ‡¶∂‡¶æ‡¶®‡ßç‡¶§‡¶ø! ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ñ‡ßç‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶® ‡¶≠‡¶æ‡¶∞‡ßç‡¶ö‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶à‡¶∂‡ßç‡¶¨‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø‡ßá ‡¶Ü‡¶∞‡¶ì ‡¶ó‡¶≠‡ßÄ‡¶∞‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶õ‡¶ø‡•§ ‡¶Ü‡¶Ø‡¶º‡¶æ‡¶§, ‡¶¨‡¶æ‡¶á‡¶¨‡ßá‡¶≤‡ßá‡¶∞ ‡¶ö‡¶∞‡¶ø‡¶§‡ßç‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡¶æ ‡¶ñ‡ßç‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶® ‡¶¶‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø‡¶ï‡ßã‡¶£ ‡¶•‡ßá‡¶ï‡ßá ‡¶ú‡ßÄ‡¶¨‡¶®‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶§‡ßá ‡¶¶‡ßç‡¶¨‡¶ø‡¶ß‡¶æ ‡¶¨‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "input_placeholder": "‡¶¨‡¶≤‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...", "input_placeholder_no_mic": "‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...", "listening": "üéôÔ∏è ‡¶∂‡ßÅ‡¶®‡¶õ‡¶ø...", "typing_indicator": "‡¶∂‡¶¨‡ßç‡¶¶ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶ß‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ", "error_message": "‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∑, ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®.", "mic_denied": "‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏‡ßá ‡¶è‡¶ü‡¶ø ‡¶∏‡¶ï‡ßç‡¶∑‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "mic_error": "‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶∞‡¶ø‡¶ï‡¶ó‡¶®‡¶ø‡¶∂‡¶®‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§" },
            "ar": { "title": "ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑŸÖÿ≥Ÿäÿ≠Ÿä - ÿ≠Ÿàÿßÿ± ÿßŸÑÿ•ŸäŸÖÿßŸÜ", "header_alt": "ÿµŸàÿ±ÿ© Ÿäÿ≥Ÿàÿπ ÿßŸÑŸÖÿ≥Ÿäÿ≠", "header_title": "ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑŸÖÿ≥Ÿäÿ≠Ÿä", "header_subtitle": "ÿ±ŸÅŸäŸÇŸÉ ŸÑŸÑÿ™ÿ£ŸÖŸÑ ŸàÿØÿ±ÿßÿ≥ÿ© ÿßŸÑŸÉŸÑŸÖÿ©.", "welcome_message": "ÿ≥ŸÑÿßŸÖ ÿßŸÑÿ±ÿ®! ÿ£ŸÜÿß ŸÖÿ≥ÿßÿπÿØŸÉ ÿßŸÑÿßftÿ±ÿßÿ∂Ÿä ÿßŸÑŸÖÿ≥Ÿäÿ≠Ÿä. ÿ£ŸÜÿß ŸáŸÜÿß ŸÑŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿπŸÑŸâ ÿßŸÑÿ™ÿπŸÖŸÇ ŸÅŸä ŸÉŸÑŸÖÿ© ÿßŸÑŸÑŸá. ŸÑÿß ÿ™ÿ™ÿ±ÿØÿØ ŸÅŸä ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿπŸÜ ÿßŸÑÿ¢Ÿäÿßÿ™ ŸàÿßŸÑÿ¥ÿÆÿµŸäÿßÿ™ ÿßŸÑŸÉÿ™ÿßÿ®Ÿäÿ© ÿ£Ÿà ÿßŸÑÿ™ÿ≠ÿØÿ´ ÿπŸÜ ÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ≠Ÿäÿßÿ© ŸÖŸÜ ŸÖŸÜÿ∏Ÿàÿ± ŸÖÿ≥Ÿäÿ≠Ÿä.", "input_placeholder": "ÿ™ÿ≠ÿØÿ´ ÿ£Ÿà ÿßŸÉÿ™ÿ®...", "input_placeholder_no_mic": "ÿßŸÉÿ™ÿ®...", "listening": "üéôÔ∏è ÿ£ÿ≥ÿ™ŸÖÿπ...", "typing_indicator": "ÿ£ÿ™ÿ£ŸÖŸÑ ŸÅŸä ÿßŸÑŸÉŸÑŸÖÿ©", "error_message": "ÿ≥ÿßŸÖÿ≠ŸÜŸä Ÿäÿß ÿÆÿ±ÿßŸÅŸä, ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.", "mic_denied": "ÿ™ŸÖ ÿ±ŸÅÿ∂ ÿ•ÿ∞ŸÜ ÿßŸÑŸÖŸäŸÉÿ±ŸàŸÅŸàŸÜ. Ÿäÿ±ÿ¨Ÿâ ÿ™ŸÖŸÉŸäŸÜŸá ŸÅŸä ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠.", "mic_error": "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿµŸàÿ™„ÄÇ" }
        };

        let currentLang = 'pt';

        function setLanguage(lang) {
            const langCode = (lang || 'pt').split('-')[0];
            currentLang = translations[langCode] ? langCode : 'en';
            document.documentElement.lang = currentLang;
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                const dict = translations[currentLang] || translations['en'];
                if (dict[key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = dict[key];
                    } else if (element.tagName === 'IMG') {
                        element.alt = dict[key];
                    } else {
                        element.textContent = dict[key];
                    }
                }
            });
        }

        userInput.addEventListener('input', () => { if (userInput.value.trim() !== '') { sendButton.classList.remove('hidden'); micWrapper.classList.add('hidden'); } else { sendButton.classList.add('hidden'); micWrapper.classList.remove('hidden'); } });
        
        async function sendMessage(directMessage = null) {
            const message = directMessage || userInput.value.trim();
            if (!message) return;

            appendMessage(message, 'user');
            if (directMessage === null) { userInput.value = ''; userInput.dispatchEvent(new Event('input')); }
            showTypingIndicator();
            try {
                const response = await fetch('/api/ask-christian-ai', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ question: message, language: currentLang }), });
                if (!response.ok) { const errorData = await response.json(); throw new Error(`Erro no servidor: ${response.status} - ${errorData.error}`); }
                const data = await response.json();
                removeTypingIndicator();
                appendMessage(data.answer, 'ai');
            } catch (error) {
                console.error('Erro ao comunicar com o backend:', error);
                removeTypingIndicator();
                appendMessage((translations[currentLang] || translations['en']).error_message, 'ai');
            }
        }

        sendButton.addEventListener('click', () => sendMessage());
        userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); sendMessage(); } });

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition && !/iPhone/i.test(navigator.userAgent)) {
            const recognition = new SpeechRecognition();
            let isRecognizing = false;
            
            recognition.interimResults = false;
            recognition.continuous = false;

            micButton.addEventListener('click', () => {
                if (isRecognizing) {
                    recognition.stop();
                } else {
                    recognition.lang = currentLang === 'en' ? 'en-US' : `${currentLang}-${currentLang.toUpperCase()}`;
                    try { recognition.start(); } catch (error) {
                        console.error("Erro ao iniciar o reconhecimento de voz:", error);
                        appendMessage((translations[currentLang] || translations['en']).mic_error, 'system-error');
                    }
                }
            });

            recognition.onstart = () => {
                isRecognizing = true;
                micWrapper.classList.add('recording');
                appendMessage((translations[currentLang] || translations['en']).listening, 'system');
            };

            recognition.onend = () => {
                isRecognizing = false;
                micWrapper.classList.remove('recording');
                removeSystemMessage();
            };

            recognition.onresult = (event) => {
                const transcript = event.results[event.results.length - 1][0].transcript.trim();
                if (transcript) { sendMessage(transcript); }
            };
            
            recognition.onerror = (event) => {
                let msg = (translations[currentLang] || translations['en']).mic_error;
                if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
                    msg = (translations[currentLang] || translations['en']).mic_denied;
                }
                console.error('Erro no reconhecimento de voz:', event.error);
                removeSystemMessage();
                appendMessage(msg, 'system-error');
            };
        } else {
            const micWrapper = document.querySelector('.mic-wrapper');
            if (micWrapper) { micWrapper.style.display = 'none'; }
        }

        function appendMessage(message, sender) { const messageWrapper = document.createElement('div'); const messageBubble = document.createElement('div'); if (sender === 'user') { messageWrapper.className = 'message-user mb-4 flex justify-end'; messageBubble.className = 'bg-blue-600 text-white rounded-lg rounded-br-none p-3 max-w-lg'; } else if (sender === 'ai') { messageWrapper.className = 'message-ai mb-4 flex'; messageBubble.className = 'bg-slate-200 text-slate-800 rounded-lg rounded-bl-none p-3 max-w-lg'; } else { const existing = document.getElementById('system-message'); if (existing) existing.remove(); messageWrapper.id = 'system-message'; messageWrapper.className = 'message-system mb-4 flex justify-center'; messageBubble.className = sender === 'system-error' ? 'bg-red-100 text-red-700 rounded-lg p-2 text-xs' : 'bg-yellow-100 text-yellow-700 rounded-lg p-2 text-xs'; } messageBubble.innerHTML = `<p class="text-sm">${message.replace(/\n/g, '<br>')}</p>`; messageWrapper.appendChild(messageBubble); chatWindow.appendChild(messageWrapper); chatWindow.scrollTop = chatWindow.scrollHeight; }
        function removeSystemMessage() { const el = document.getElementById('system-message'); if (el) el.remove(); }
        function showTypingIndicator() { const ind = `<div id="typing-indicator" class="message-ai mb-4 flex"><div class="bg-slate-200 text-slate-800 rounded-lg rounded-bl-none p-3 max-w-lg"><div class="flex items-center space-x-1"><span class="text-sm">${(translations[currentLang] || translations['en']).typing_indicator}</span><div class="h-2 w-2 bg-slate-400 rounded-full animate-bounce [animation-delay:-0.3s]"></div><div class="h-2 w-2 bg-slate-400 rounded-full animate-bounce [animation-delay:-0.15s]"></div><div class="h-2 w-2 bg-slate-400 rounded-full animate-bounce"></div></div></div></div>`; chatWindow.insertAdjacentHTML('beforeend', ind); chatWindow.scrollTop = chatWindow.scrollHeight; }
        function removeTypingIndicator() { const el = document.getElementById('typing-indicator'); if (el) el.remove(); }
        
        window.addEventListener('load', () => {
            const userLang = navigator.language || navigator.userLanguage;
            setLanguage(userLang.startsWith('pt') ? 'pt' : 'en');
            
            const isIPhone = /iPhone/i.test(navigator.userAgent);
            if (isIPhone) {
                const micWrapper = document.querySelector('.mic-wrapper');
                if (micWrapper) {
                    micWrapper.style.display = 'none';
                }
                const dict = translations[currentLang] || translations['en'];
                userInput.placeholder = dict.input_placeholder_no_mic;
            }
            userInput.focus();
        });
    </script>
</body>
</html>
